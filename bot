import 'dotenv/config';
import { Telegraf, Markup } from 'telegraf';

const BOT_TOKEN = process.env.BOT_TOKEN;
if (!BOT_TOKEN) {
  console.error("Missing BOT_TOKEN in .env");
  process.exit(1);
}

const bot = new Telegraf(BOT_TOKEN);

// === YOUR PROJECT INFO ===
const PROJECT = {
  name: "OVERLANDCOIN",
  symbol: "OLC",
  supply: "3,000,000,000",
  contract: "0xdc484e4ad0cB6007f10220144Ae986cbe7aC1611",
  explorerBase: "https://bdagscan.com",
  website: "https://overlandcoin.vercel.app", // change if different
  telegram: "https://t.me/YourTelegramLink",  // update
  x: "https://x.com/YourXLink"                // update
};

const contractUrl = `${PROJECT.explorerBase}/address/${PROJECT.contract}`;

function mainMenu() {
  return Markup.inlineKeyboard([
    [Markup.button.url("View Contract", contractUrl), Markup.button.callback("Copy Contract", "COPY_CONTRACT")],
    [Markup.button.callback("Supply", "SHOW_SUPPLY"), Markup.button.callback("Roadmap", "SHOW_ROADMAP")],
    [Markup.button.callback("Purpose", "SHOW_PURPOSE"), Markup.button.callback("How to Buy", "SHOW_BUY")],
    [Markup.button.url("Website", PROJECT.website)],
    [Markup.button.url("Telegram", PROJECT.telegram), Markup.button.url("X", PROJECT.x)]
  ]);
}

const PURPOSE_TEXT =
`â›°ï¸ *Purpose & Vision*
${PROJECT.name} (${PROJECT.symbol}) is built for real-world exploration, long-term utility, and community growth.
The direction: an outdoors-first brand + future real-world integrations (including app/utility pathways).`;

const SUPPLY_TEXT =
`ðŸª™ *Token Supply*
*Total Supply:* ${PROJECT.supply} ${PROJECT.symbol}
*Contract:* \`${PROJECT.contract}\`
*Explorer:* ${contractUrl}`;

const ROADMAP_TEXT =
`ðŸ§­ *Roadmap*
*Phase 1 â€” Foundation*
â€¢ Website + branding
â€¢ Community channels
â€¢ Transparency + explorer visibility

*Phase 2 â€” Growth*
â€¢ Partnerships & outreach
â€¢ Listings visibility
â€¢ Community campaigns

*Phase 3 â€” Utility Build*
â€¢ Utility/app direction planning
â€¢ Pilot features + community input

*Phase 4 â€” Expansion*
â€¢ Integrations + ecosystem growth`;

const BUY_TEXT =
`ðŸ›’ *How to Buy (General)*
1) Use a supported wallet on the network (as available).
2) Fund your wallet with the chainâ€™s gas token (for fees).
3) Use the official contract address to find the token:
\`${PROJECT.contract}\`
4) Double-check the explorer link before swapping.

âš ï¸ Always verify links. Never trust random DMs.`;

bot.start(async (ctx) => {
  const name = ctx.from?.first_name ?? "traveler";
  const msg =
`Welcome, ${name} ðŸŒ²

*${PROJECT.name} (${PROJECT.symbol})* â€” Built for the open road.
Use the buttons below for contract, supply, roadmap, and links.`;

  await ctx.replyWithMarkdown(msg, mainMenu());
});

bot.command("help", (ctx) => {
  ctx.replyWithMarkdown(
`*Commands*
/start â€“ main menu
/contract â€“ explorer + contract
/supply â€“ total supply
/purpose â€“ mission
/roadmap â€“ plan
/buy â€“ general buying steps
/links â€“ official links`,
  mainMenu());
});

bot.command("contract", (ctx) => ctx.replyWithMarkdown(`ðŸ”Ž *Contract*\n\`${PROJECT.contract}\`\n${contractUrl}`, mainMenu()));
bot.command("supply", (ctx) => ctx.replyWithMarkdown(SUPPLY_TEXT, mainMenu()));
bot.command("purpose", (ctx) => ctx.replyWithMarkdown(PURPOSE_TEXT, mainMenu()));
bot.command("roadmap", (ctx) => ctx.replyWithMarkdown(ROADMAP_TEXT, mainMenu()));
bot.command("buy", (ctx) => ctx.replyWithMarkdown(BUY_TEXT, mainMenu()));
bot.command("links", (ctx) => ctx.replyWithMarkdown(
`ðŸ”— *Official Links*
Website: ${PROJECT.website}
Explorer: ${PROJECT.explorerBase}
Contract: \`${PROJECT.contract}\``,
mainMenu()
));

// Button actions
bot.action("COPY_CONTRACT", async (ctx) => {
  await ctx.answerCbQuery("Copied!");
  await ctx.replyWithMarkdown(`ðŸ“‹ Contract:\n\`${PROJECT.contract}\``);
});

bot.action("SHOW_SUPPLY", async (ctx) => {
  await ctx.answerCbQuery();
  await ctx.replyWithMarkdown(SUPPLY_TEXT, mainMenu());
});

bot.action("SHOW_ROADMAP", async (ctx) => {
  await ctx.answerCbQuery();
  await ctx.replyWithMarkdown(ROADMAP_TEXT, mainMenu());
});

bot.action("SHOW_PURPOSE", async (ctx) => {
  await ctx.answerCbQuery();
  await ctx.replyWithMarkdown(PURPOSE_TEXT, mainMenu());
});

bot.action("SHOW_BUY", async (ctx) => {
  await ctx.answerCbQuery();
  await ctx.replyWithMarkdown(BUY_TEXT, mainMenu());
});

// Basic safety: ignore other bots
bot.on("message", (ctx, next) => {
  if (ctx.from?.is_bot) return;
  return next();
});

// Fallback
bot.on("text", (ctx) => {
  ctx.replyWithMarkdown(
`ðŸŒ¿ I can help with:
â€¢ Contract
â€¢ Supply
â€¢ Roadmap
â€¢ Links

Type /start to open the menu.`,
mainMenu()
);
});

bot.launch().then(() => console.log("OLC bot running âœ…"));

process.once("SIGINT", () => bot.stop("SIGINT"));
process.once("SIGTERM", () => bot.stop("SIGTERM"));